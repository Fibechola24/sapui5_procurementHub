<mvc:View
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:layout="sap.ui.layout"
    xmlns:form="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    controllerName="ui5.procurementhub.controller.CreatePR"
    displayBlock="true">
    
    <Page 
        id="createPRPage"
        title="Create Purchase Request"
        showNavButton="true"
        navButtonPress=".onNavBack"
        class="sapUiResponsiveContentPadding">
        
        <headerContent>
            <Button 
                type="Emphasized"
                text="Submit"
                icon="sap-icon://accept"
                press=".onSubmit"/>
            <Button 
                text="Save Draft"
                icon="sap-icon://save"
                press=".onSaveDraft"/>
            <Button 
                text="Clear"
                icon="sap-icon://clear-filter"
                press=".onClear"/>
        </headerContent>
        
        <content>
            <ScrollContainer 
                height="100%" 
                width="100%" 
                vertical="true" 
                horizontal="false">
                
                <!-- Header Information -->
                <Panel headerText="Request Information" expandable="true" expanded="true">
                    <content>
                        <form:SimpleForm 
                            editable="true"
                            layout="ResponsiveGridLayout"
                            labelSpanXL="4"
                            labelSpanL="3"
                            labelSpanM="4"
                            labelSpanS="12"
                            adjustLabelSpan="false"
                            emptySpanXL="0"
                            emptySpanL="4"
                            emptySpanM="0"
                            emptySpanS="0"
                            columnsXL="2"
                            columnsL="1"
                            columnsM="1"
                            singleContainerFullSize="false">
                            
                            <Label text="Request Type" required="true"/>
                            <Select
                                selectedKey="{/requestType}"
                                items="{
                                    path: '/requestTypes',
                                    templateShareable: false
                                }">
                                <core:Item key="{key}" text="{text}"/>
                            </Select>
                            
                            <Label text="Priority" required="true"/>
                            <Select
                                selectedKey="{/priority}"
                                items="{
                                    path: '/priorities',
                                    templateShareable: false
                                }">
                                <core:Item key="{key}" text="{text}"/>
                            </Select>
                            
                            <Label text="Department" required="true"/>
                            <Input value="{/department}"/>
                            
                            <Label text="Cost Center" required="true"/>
                            <Input value="{/costCenter}"/>
                            
                            <Label text="Required By" required="true"/>
                            <DatePicker value="{/requiredDate}" valueFormat="yyyy-MM-dd" displayFormat="long"/>
                            
                            <Label text="Justification"/>
                            <TextArea value="{/justification}" rows="3"/>
                            
                        </form:SimpleForm>
                    </content>
                </Panel>
                
                <!-- Items Table -->
                <Panel headerText="Items" expandable="true" expanded="true" class="sapUiMediumMarginTop">
                    <headerToolbar>
                        <OverflowToolbar>
                            <Title text="Items (0)" level="H3" id="itemsCountTitle"/>
                            <ToolbarSpacer/>
                            <Button 
                                icon="sap-icon://add"
                                text="Add Item"
                                press=".onAddItem"/>
                        </OverflowToolbar>
                    </headerToolbar>
                    
                    <content>
                        <Table 
                            id="itemsTable"
                            items="{path: '/items', templateShareable: false}"
                            mode="Delete"
                            delete=".onDeleteItem"
                            class="sapUiResponsiveMargin">
                            
                            <headerToolbar>
                                <OverflowToolbar>
                                    <content>
                                        <ToolbarSpacer/>
                                        <SearchField 
                                            width="20rem"
                                            placeholder="Search items..."
                                            search=".onSearchItems"/>
                                    </content>
                                </OverflowToolbar>
                            </headerToolbar>
                            
                            <columns>
                                <Column>
                                    <Text text="Item"/>
                                </Column>
                                <Column>
                                    <Text text="Description"/>
                                </Column>
                                <Column>
                                    <Text text="Quantity"/>
                                </Column>
                                <Column>
                                    <Text text="Unit Price"/>
                                </Column>
                                <Column>
                                    <Text text="Total"/>
                                </Column>
                                <Column width="80px">
                                    <Text text="Actions"/>
                                </Column>
                            </columns>
                            
                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <Input value="{itemCode}"/>
                                        <Input value="{description}"/>
                                        <Input value="{quantity}" type="Number"/>
                                        <Input value="{unitPrice}" type="Number"/>
                                        <ObjectNumber 
                                            number="{= ${quantity} * ${unitPrice} }"
                                            unit="USD"
                                            state="Success"/>
                                        <HBox>
                                            <Button 
                                                icon="sap-icon://edit"
                                                tooltip="Edit"
                                                type="Transparent"
                                                press=".onEditItem"/>
                                            <Button 
                                                icon="sap-icon://copy"
                                                tooltip="Duplicate"
                                                type="Transparent"
                                                press=".onDuplicateItem"/>
                                        </HBox>
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </content>
                </Panel>
                
                <!-- Attachments -->
                <Panel headerText="Attachments" expandable="true" expanded="false" class="sapUiMediumMarginTop">
                    <content>
                        <UploadCollection
                            id="uploadCollection"
                            maximumFilenameLength="55"
                            multiple="true"
                            sameFilenameAllowed="true"
                            instantUpload="false"
                            noDataText="Drop files or use 'Add' to upload files"
                            change=".onAttachmentChange"
                            fileDeleted=".onAttachmentDeleted"
                            filenameLengthExceed=".onFilenameLengthExceed"
                            fileRenamed=".onFileRenamed"
                            selectionChange=".onSelectionChange"
                            uploadComplete=".onUploadComplete"
                            items="{
                                path: '/attachments',
                                templateShareable: false
                            }">
                            
                            <toolbar>
                                <OverflowToolbar>
                                    <Title/>
                                    <ToolbarSpacer/>
                                    <Button 
                                        icon="sap-icon://add"
                                        tooltip="Add"
                                        press=".onAddAttachment"/>
                                </OverflowToolbar>
                            </toolbar>
                            
                            <items>
                                <UploadCollectionItem
                                    documentId="{documentId}"
                                    fileName="{fileName}"
                                    mimeType="{mimeType}"
                                    url="{url}"
                                    enableEdit="true"
                                    enableDelete="true"
                                    visibleEdit="true"
                                    visibleDelete="true"/>
                            </items>
                        </UploadCollection>
                    </content>
                </Panel>
                
                <!-- Review Section -->
                <Panel headerText="Review" expandable="true" expanded="false" class="sapUiMediumMarginTop">
                    <content>
                        <form:SimpleForm 
                            editable="false"
                            layout="ResponsiveGridLayout">
                            <Label text="Total Items"/>
                            <Text text="{= ${/items}.length }"/>
                            
                            <Label text="Estimated Total"/>
                            <ObjectNumber 
                                id="totalAmount"
                                number="{/totalAmount}"
                                unit="USD"
                                state="Success"/>
                            
                            <Label text="Created By"/>
                            <Text text="{/createdBy}"/>
                            
                            <Label text="Creation Date"/>
                            <Text text="{/creationDate}"/>
                        </form:SimpleForm>
                    </content>
                </Panel>
                
            </ScrollContainer>
        </content>
        
        <footer>
            <OverflowToolbar>
                <ToolbarSpacer/>
                <Button 
                    type="Reject"
                    text="Cancel"
                    icon="sap-icon://decline"
                    press=".onCancel"/>
                <Button 
                    type="Emphasized"
                    text="Submit"
                    icon="sap-icon://accept"
                    press=".onSubmit"/>
            </OverflowToolbar>
        </footer>
        
    </Page>
    
</mvc:View>